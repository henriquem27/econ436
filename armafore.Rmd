---
title: "Crypto Currencies Forecasting"
author: "Henrique Magalhaes Rio"
output:
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tseries)
library(ggpubr)
library(forecast)
library(lubridate)
library(lmtest)
set.seed(2022)

```


# Introduction

In this paper I will analyze and forecast 4 different crypto currencies using ARIMA, For the currencies I choose Bitcoin, Ethereum, Cardano, and Waves. This choice was made as with these 4 crypto currencies I have 2 mainstream ones that have their price in the thousands of USD, and 2 coins that are still on the rise and have a much lower price. The reason for the split between the two types of crypto currencies is that I would like to see if the market for crypto currencies behave the same way for the more mainstream coins and for the cheaper less known, in essence if the models used to estimate Bitcoin and Ethereum are similar or not to those used to forecast Cardano and Waves.



```{r data loading, include=FALSE}
knitr::opts_chunk$set(
  comment = "#>", echo = FALSE
)
data <- read.csv("CLOSINGPRICEDATA.csv")

data$Date <-mdy(data$Date)


datadif <-data  %>% mutate(difbtc = data$BTC - lag(data$BTC))

datadif <-datadif %>% mutate(difada = data$ADA - lag(data$ADA))

datadif <-datadif  %>% mutate(difwave = data$WAVES - lag(data$WAVES))

datadif <-datadif  %>% mutate(difeth = data$ETH - lag(data$ETH))

```


# Series and First difference Plots

```{r Series plot, message=FALSE, warning=FALSE,echo=FALSE}

#level Plot

btc <- ggplot(data) +
  geom_line(aes(x=Date, y=BTC))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Bitcoin (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))



ADA <- ggplot(data) +
  geom_line(aes(x=Date, y=ADA))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Cardano (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))



WAVE <- ggplot(data) +
  geom_line(aes(x=Date, y=WAVES))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of WAVES (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))




ETH <- ggplot(data) +
  geom_line(aes(x=Date, y=ETH))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Ethereum (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))


ggarrange(btc,ETH,ADA,WAVE)

# 1st dif

btc <- ggplot(datadif) +
  geom_line(aes(x=Date, y=difbtc))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Bitcoin (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))



ADA <- ggplot(datadif) +
  geom_line(aes(x=Date, y=difada))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Cardano (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))



WAVE <- ggplot(datadif) +
  geom_line(aes(x=Date, y=difwave))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of WAVES (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))




ETH <- ggplot(datadif) +
  geom_line(aes(x=Date, y=difeth))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Ethereum (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))


ggarrange(btc,ETH,ADA,WAVE)




#data$BTC %>% diff() %>% ggtsdisplay(main="")

```


Looking at the plots I have decided to cut data at 2019-09-30. The reasoning behind this choice was that the crypto currencies have a period of high volatility in the beginning of the series, they then go through a period of "stability" the lasts up until the beginning of 2021. Hence, but making this I can have forcasting models that work for both periods.



# Steps for Forecasting

The First step for forecasting is looking at the Auto Correlation Function (ACF), as we are looking for potential significant correlations on the lags that can be used for forecasting, if there is a significance it means that we can use the significant lag in order to forecast on the next period of the series. Once we find the lags with statistical significance we can then estimate the ARIMA model, and verify the significance of the coefficients. Next we have to check the residual correlelogram to make sure none of the lag coefficients are significant since that would mean that the errors are not white noise, and therefore, the model we have used is still missing lags that are unaccounted for which must be added for the model.


# Model Estimation


## Bitcoin


### ACF for Bitcoin


```{r btc, echo=FALSE}

data1 <- data[1:100,]
data2 <- data[100:210,]
data1$BTC %>% diff() %>% ggtsdisplay(main="Bitcoin Period 1 - 2017-11-06 to 2019-09-30
")
data2$BTC %>% diff() %>% ggtsdisplay(main="Bitcoin Period 2 - 2019-09-30 to 2021-11-15

 ")



```
 Looking at the ACF for Bitcoin in period 1 there seems to be significant spike at lag 3, while in period 2 it seems to be a significant spike at period 2, 4, 8, 15, also period 2 seems to have AR(2) process involved as it seems to alternate between positive and negative correlations of lags that seems to be decreasing over time.
 
 
### Model Estimation for Bitcoin 
 
```{r,echo=FALSE}
fit <- Arima(data1$BTC,order=c(0,1,11),fixed=c(0,0,NA,0,0,0,0,0,0,0,NA))
fit

coeftest(fit)

checkresiduals(fit)


```
  For the first period I ended fitting a MA3 and MA11 model, since when I fitted just the MA3 model and checked the residuals there seemed to be a spike at lag 11, therefore, I added it to the model. Checking the residuals afterwards everything is white noise and both coefficients are statistically significant.


```{r,echo=FALSE}
fit2 <- Arima(data2$BTC,order=c(0,1,15),fixed=c(0,0,0,0,0,0,0,NA,0,0,0,0,0,0,NA))
fit2




coeftest(fit2)
checkresiduals(fit2)
```
For the second period of the Bitcoin series,  I used a MA8 and MA15 for forecasting the model, initially I used the moving averages 2,4,8 and 15 but the coefficients for the MA2 and MA4 were not statistically significant, therefore, I removed both coefficients and so the final model includes only MA8 and MA15 which are both statistically significant.

```{r,echo=FALSE}
fore <- forecast(fit,h=11)
fore2 <- forecast(fit2,h=11)
```


### Forecast for Bitcoin

```{r,echo=FALSE}

tsbtc <- ts(data$BTC[1:111])

autoplot(fore)+autolayer(tsbtc,series = "Data")+autolayer(fore$mean,series = "forecast")+labs(title= "Forecasting for Bitcoin period 1",subtitle="ARIMA Model with a MA3 and MA11",y="Price")


```

For the first period we can see above that forecast for the next 11 weeks follows pretty close to the actual data, as they both portray a downward trend on the price of Bitcoin. Meanwhile, for the second period of choice the forecast completely misses the downward shift for Bitcoin for the first few weeks, and only begins to portray afterwards and the actual intensity of the price drop of Bitcoin is still much larger than the actual data.



```{r}
tsbtc <- ts(data$BTC[100:221])

autoplot(fore2)+autolayer(tsbtc,series = "Data")+autolayer(fore2$mean,series = "forecast")+labs(title= "Forecasting for Bitcoin period 2",subtitle="ARIMA Model with a MA3 and MA11",y="Price")

```

## Ethereum

### ACF for Ethereum

```{r eth, echo=FALSE}

data1$ETH %>% diff() %>% ggtsdisplay(main="Ethereum Period 1")

data2$ETH %>% diff() %>% ggtsdisplay(main="Ethereum Period 2")



```


Looking at the ACF for Ethereum we can see that for the first period there is only one spike at lag 4. Meanwhile, for the second period, there seems to be several spikes at lag 2,4,6,7,10,12,14, and 17, which is quite different from the first period.

### Model Estimation for Ethereum

```{r}

fit <- Arima(data1$ETH,order=c(0,1,4),fixed=c(0,0,NA,NA))
fit

coeftest(fit)

checkresiduals(fit)



```



### Forecasts for Ethereum



```{r,echo=FALSE}
fore <- forecast(fit,h=11)
fore2 <- forecast(fit2,h=11)
```


```{r,echo=FALSE}

tsbtc <- ts(data$ETH[1:111])

autoplot(fore)+autolayer(tsbtc,series = "Data")+autolayer(fore$mean,series = "forecast")+labs(title= "Forecasting for Ethereum period 1",subtitle="ARIMA Model with a MA3 and MA11",y="Price")


```

## Cardano

```{r ada,echo=FALSE}
data1$ADA %>% diff() %>% ggtsdisplay(main="ADA Period 1")
data2$ADA %>% diff() %>% ggtsdisplay(main="ADA Period 2")
```



## Waves 
```{r wave,echo=FALSE}
data1$WAVES %>% diff() %>% ggtsdisplay(main="Waves Period 1")
data2$WAVES %>% diff() %>% ggtsdisplay(main="Waves Period 2")
```



















