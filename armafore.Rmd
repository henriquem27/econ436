---
title: "Forecasting Arima"
output:
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tseries)
library(ggpubr)
library(forecast)
library(lubridate)
library(lmtest)
set.seed(2022)

```


# Introduction

In this paper I will analyze and forecast 4 different crypto currencies using ARIMA, For the currencies I choose Bitcoin, Ethereum, Cardano, and Waves. This choice was made as with these 4 crypto currencies I have 2 mainstream ones that have their price in the thousands of USD, and 2 coins that are still on the rise and have a much lower price. The reason for the split between the two types of crypto currencies is that I would like to see if the market for crypto currencies behave the same way for the more mainstream coins and for the cheaper less known, in essence if the models used to estimate Bitcoin and Ethereum are similar or not to those used to forecast Cardano and Waves.



```{r data loading, include=FALSE}
knitr::opts_chunk$set(
  comment = "#>", echo = FALSE
)
data <- read.csv("CLOSINGPRICEDATA.csv")

data$Date <-mdy(data$Date)


datadif <-data  %>% mutate(difbtc = data$BTC - lag(data$BTC))

datadif <-datadif %>% mutate(difada = data$ADA - lag(data$ADA))

datadif <-datadif  %>% mutate(difwave = data$WAVES - lag(data$WAVES))

datadif <-datadif  %>% mutate(difeth = data$ETH - lag(data$ETH))

```


# Series and First difference Plots

```{r Series plot, message=FALSE, warning=FALSE,echo=FALSE}

#level Plot

btc <- ggplot(data) +
  geom_line(aes(x=Date, y=BTC))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Bitcoin (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))



ADA <- ggplot(data) +
  geom_line(aes(x=Date, y=ADA))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Cardano (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))



WAVE <- ggplot(data) +
  geom_line(aes(x=Date, y=WAVES))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of WAVES (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))




ETH <- ggplot(data) +
  geom_line(aes(x=Date, y=ETH))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Ethereum (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))


ggarrange(btc,ETH,ADA,WAVE)

# 1st dif

btc <- ggplot(datadif) +
  geom_line(aes(x=Date, y=difbtc))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Bitcoin (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))



ADA <- ggplot(datadif) +
  geom_line(aes(x=Date, y=difada))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Cardano (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))



WAVE <- ggplot(datadif) +
  geom_line(aes(x=Date, y=difwave))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of WAVES (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))




ETH <- ggplot(datadif) +
  geom_line(aes(x=Date, y=difeth))+labs(y="Price",x="Date(Month-Year)",title ="Closing Price of Ethereum (Weekly) ")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 10))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))


ggarrange(btc,ETH,ADA,WAVE)




#data$BTC %>% diff() %>% ggtsdisplay(main="")

```


Looking at the plots I have decided to cut data at 2019-09-30. The reasoning behind this choice was that the crypto currencies have a period of high volatility in the beginning of the series, they then go through a period of "stability" the lasts up until the beginning of 2021. Hence, but making this I can have forcasting models that work for both periods.



# Steps for Forecasting

The First step for forecasting is looking at the Auto Correlation Function (ACF), as we are looking for potential significant correlations on the lags that can be used for forecasting, if there is a significance it means that we can use the significant lag in order to forecast on the next period of the series. Once we find the lags with statistical significance we can then estimate the ARIMA model, and verify the significance of the coefficients. Next we have to check the residual correlelogram to make sure none of the lag coefficients are significant since that would mean that the errors are not white noise, and therefore, the model we have used is still missing lags that are unaccounted for which must be added for the model.


# Model Estimation


## Bitcoin


```{r btc, echo=FALSE}

data1 <- data[1:100,]
data2 <- data[100:210,]
data1$BTC %>% diff() %>% ggtsdisplay(main="Bitcoin Period 1 - 2017-11-06 to 2019-09-30
")
data2$BTC %>% diff() %>% ggtsdisplay(main="Bitcoin Period 2 - 2019-09-30 to 2021-11-15

 ")



```
 Looking at the ACF for Bitcoin in period 1 there seems to be significant spike at lag 3, while in period 2 it seems to be a significant spike at period 2, 4, 8, 15, also period 2 seems to have AR(2) process involved as it seems to alternate between positive and negative correlations of lags that seems to be decreasing over time.
 
 
```{r}
fit <- Arima(data1$BTC,order=c(0,1,11),fixed=c(0,0,NA,0,0,0,0,0,0,0,NA))
fit

coeftest(fit)

checkresiduals(fit)


```
For the first period I ended fitting a MA3 and MA11 model, since when I fitted just the MA3 model and checked the residuals there seemed to be a spike at lag 11, therefore, I added it to the model and checking the residuals afterwards everything is white noise and both coefficients are statistically significant.


```{r}
fit2 <- Arima(data2$BTC,order=c(0,1,15),fixed=c(0,0,0,0,0,0,0,NA,0,0,0,0,0,0,NA))
fit2

coeftest(fit2)
checkresiduals(fit2)
```
For the second period of the Bitcoin series,  I used a MA8 and MA15 for forecasting the model, initially I used the moving averages 2,4,8 and 15 but the coefficients for the MA2 and MA4 were not statistically significant, therefore, I removed both coefficients and so the final model includes only MA8 and MA15 which are both statistically significant.

```{r}
fore <- forecast(fit,h=11)
fore2 <- forecast(fit2,h=11)
```


```{r}

tsbtc <- ts(data$BTC[1:111])

autoplot(fore)+autolayer(tsbtc,series = "Data")+autolayer(fore$mean,series = "forecast")+labs(title= "Forecasting for Bitcoin period 1",subtitle="ARIMA Model with a MA3 and MA11",y="Price")

tsbtc <- ts(data$BTC[100:221])

autoplot(fore2)+autolayer(tsbtc,series = "Data")+autolayer(fore2$mean,series = "forecast")


```


## Etherium

```{r eth, echo=FALSE}

data1$ETH %>% diff() %>% ggtsdisplay(main="ETH Period 1")

data2$ETH %>% diff() %>% ggtsdisplay(main="ETH Period 2")



```

## Cardano

```{r ada,echo=FALSE}
data1$ADA %>% diff() %>% ggtsdisplay(main="ADA Period 1")
data2$ADA %>% diff() %>% ggtsdisplay(main="ADA Period 2")
```



## Waves 
```{r wave,echo=FALSE}
data1$WAVES %>% diff() %>% ggtsdisplay(main="Waves Period 1")
data2$WAVES %>% diff() %>% ggtsdisplay(main="Waves Period 2")
```















```{r}
fit <- Arima(btcut$Close,order=c(2,2,10))
fit
checkresiduals(fit)
fit <- Arima(btcut$Close,order=c(2,1,20))
fit
checkresiduals(fit)
fit <- Arima(btcut$Close,order=c(1,1,5))
fit
checkresiduals(fit)
fit <- Arima(btcut$Close,order=c(2,1,25))
fit
checkresiduals(fit)

```


```{r}


fore <- forecast(fit,h=20)


```


```{r}
tsbtc <- ts(btcut <- btc$Close[1:385])

autoplot(fore)+autolayer(tsbtc,series = "Data")+autolayer(fore$mean,series = "forecast")



```






# Ethereum


```{r,fig.width=10, fig.height=6,echo=FALSE,warning=FALSE}
eth <- read.csv("ETH-USD.csv")


z <- ggplot(eth) +
  geom_line(aes(x=as.Date(Date), y=Close))+labs(y="Ethereum Price",x="Date(Month-Year)",title ="Closing Price of Ethereum (Weekly) ",subtitle="Number of Observations= 221")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 15))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))

z
```

# Etherium
Cut period from 2018-10-15 to 2021-08-30


```{r}

ethcut <- eth[1:210,]

ethcut$Close %>% diff() %>% ggtsdisplay(main="")
```
 
```{r}
fiteth <- Arima(ethcut$Close,order=c(1,1,0))

fiteth

checkresiduals(fiteth)

fiteth <- Arima(ethcut$Close,order=c(2,1,25))

fiteth

checkresiduals(fiteth)
fiteth <- Arima(ethcut$Close,order=c(2,1,20))

fiteth

checkresiduals(fiteth)
fiteth <- Arima(ethcut$Close,order=c(2,1,25))

fiteth

checkresiduals(fiteth)



```


```{r}


foreeth <- forecast(fiteth,h=11)


```


```{r}
tseth <- ts(eth$Close)

autoplot(foreeth)+autolayer(tseth,series = "Data")+autolayer(foreeth$mean,series = "forecast")



```


# Monero

2018-10 to 2020-10

```{r,fig.width=10, fig.height=6,echo=FALSE}
xmr <- read.csv("XMR-USD.csv")


z <- ggplot(xmr) +
  geom_line(aes(x=as.Date(Date), y=Close))+labs(y="Price in $USD",x="Date(Month-Year)",title ="Closing Price of Monero (Weekly) ",subtitle="Number of Observations= 221")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 15))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))

z
```



```{r}

xmrcut <- xmr[50:100,]

xmrcut<-xmr

xmrcut$Close %>% diff() %>% ggtsdisplay(main="")
```
 
```{r}
fitxmr <- Arima(xmrcut$Close,order=c(1,1,0))

fitxmr
checkresiduals(fitxmr)
fitxmr <- Arima(xmrcut$Close,order=c(2,1,5))

fitxmr
checkresiduals(fitxmr)
fitxmr <- Arima(xmrcut$Close,order=c(2,1,10))

fitxmr
checkresiduals(fitxmr)
fitxmr <- Arima(xmrcut$Close,order=c(2,1,20))

fitxmr
checkresiduals(fitxmr)

```


```{r}


forexmr<- forecast(fitxmr,h=20)


```


```{r}
tsxmr <- ts(xmr$Close[50:120])

autoplot(forexmr)+autolayer(tsxmr,series = "Data")+autolayer(forexmr$mean,series = "forecast")



```



# Litecoin


```{r,fig.width=10, fig.height=6,echo=FALSE,warning=FALSE}
ltc <- read.csv("LTC-USD.csv")


z <- ggplot(ltc) +
  geom_line(aes(x=as.Date(Date), y=Close))+labs(y="Litecoin Price",x="Date(Month-Year)",title ="Closing Price of Litecoin (Weekly) ",subtitle="Number of Observations= 385")+
  scale_x_date(date_labels = "%m-%Y",breaks = scales::pretty_breaks(n = 15))+scale_y_continuous(labels=scales::dollar_format(),breaks = scales::pretty_breaks(n = 10))

z
```


2017-07 to 2021-07


```{r}

ltccut <- ltc[150:360,]

ltccut$Close %>% diff() %>% ggtsdisplay(main="")
```
 
```{r}
fitltc <- Arima(ltccut$Close,order=c(1,1,10))
fitltc
checkresiduals(fitltc)
fitltc <- Arima(ltccut$Close,order=c(2,1,25))
fitltc
checkresiduals(fitltc)
fitltc <- Arima(ltccut$Close,order=c(2,1,5))
fitltc
checkresiduals(fitltc)
fitltc <- Arima(ltccut$Close,order=c(2,1,15))
fitltc
checkresiduals(fitltc)

```


```{r}


foreltc<- forecast(fitltc,h=20)


```


```{r}
tsltc <- ts(ltc$Close[150:380])

autoplot(foreltc)+autolayer(tsltc,series = "Data")+autolayer(foreltc$mean,series = "forecast")



```


LTC new


```{r}



ltc$Close %>% diff() %>% ggtsdisplay(main="")
```
 
```{r}


fitltc <- Arima(ltc$Close,order=c(2,1,25))
fitltc
checkresiduals(fitltc)

```


```{r}


foreltc<- forecast(fitltc,h=20)

autoplot(foreltc)
```


```{r}
tsltc <- ts(ltc$Close[150:380])

autoplot(foreltc)+autolayer(tsltc,series = "Data")+autolayer(foreltc$mean,series = "forecast")



```
